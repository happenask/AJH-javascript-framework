function toposort(e,t){function n(i,s,c){if(c.indexOf(i)>=0)throw new Error("Cyclic Dependency: "+i);if(!a[s]){a[s]=!0;var l=t.filter(function(e){return e[0]===i});if(s=l.length){var p=c.concat(i);do{var u=l[--s][1];n(u,e.indexOf(u),p)}while(s)}o[--r]=i}}for(var r=e.length,o=new Array(r),a={},i=r;i--;)a[i]||n(e[i],i,[]);return console.log("sorted "+o),o}function uniqueNodes(e){for(var t=[],n=0,r=e.length;r>n;n++){var o=e[n];t.indexOf(o[0])<0&&t.push(o[0]),t.indexOf(o[1])<0&&t.push(o[1])}return t}function makeComponent(e){var t=/^[^\(]*\(\s*([^\)]*)\)/m,n=/,/,r=/^\s*(_?)(\S+?)\1\s*$/,o=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,a={};if("function"==typeof e){a.$const=e,a.$inject=[];var i=e.toString().replace(o,""),s=i.match(t);s[1].split(n).forEach(function(e){e.replace(r,function(e,t,n){a.$inject.push(n)})})}else e.constructor===Array&&(1===e.length?(a.$const=e[0],a.$inject=[]):(a.$const=e[e.length-1],a.$inject=e.slice(0,e.length-1)));return a}function makePhase(e){var t=[],n=[];for(var r in e.$component){var o=e.$component[r];if(0==o.$inject.length){var a=[];a.push(r),a.push(void 0),n.push(a)}else for(var i=0;i<o.$inject.length;i++){var a=[];a.push(r),a.push(o.$inject[i]),n.push(a)}}console.log(n);for(var s=toposort(uniqueNodes(n),n),c=s.length-1,i=c;i>=0;i--){var r=s[i];if(e.$component[r]){for(var l=e.$component[r].$inject.length,t=[],p=0;l>p;p++){var u=e.$component[r].$inject[p];if(!e.$injectable[u])throw new Error("No Module : "+u);t.push(e.$injectable[u])}if("config"===e.$component[r].type)e.$component[r].$const.apply(e.$component[r].$const,t);else if("controller"===e.$component[r].type){var h={};h.id=makeScope(),e.$component[r].$scope=h,e.$component[r].$const.apply(e.$component[r].$scope,t)}else if("factory"===e.$component[r].type)e.$injectable[r]=e.$component[r].$const=e.$component[r].$const.apply(e.$component[r],t);else if("provider"===e.$component[r].type){if(e.$injectable[r]=e.$component[r].$const=e.$component[r].$const.apply(e.$component[r],t),!e.$component[r].$const.$config)throw new Error("Provider has to define '$config' property : "+r);app_container.defineFactory(r,e.$component[r].$const.$config)}}}}function makeScopeId(){var e=0;return function(){return e+=1}}function getIEVersion(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");return null!=n.exec(t)&&(e=parseFloat(RegExp.$1)),e}}function extend(e,t){for(var n in t)e[n]=t[n];return e}function each(e,t){for(var n=0,r=e.length;r>n;n++)t(n,e[n])}function jsVar(e){return String(e||"").replace(/-/g,"_")}function myArr(e){return"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]),e.length=e.length,e}function encodeFormData(e){var t=[],n=/%20/g;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r].toString(),a=encodeURIComponent(r).replace(n,"+")+"="+encodeURIComponent(o).replace(n,"+");t.push(a)}return t.join("&")}!function(){window.templateCache={},window.templateCache["inject.html"]='<h1>Page 1: <%greeting%></h1><p><%moreText %></p><button class="my-button">Click me</button>',window.templateCache["inject2.html"]='<h1>Page 2: <%heading%></h1><button class="my-button">Click me</button>',window.templateCache["inject3.html"]="<h1>Page 3: <%heading.head%></h1><p> <%heading.content%></p> <%for(var index in heading) {%> <h3><%heading[index]%></h3> <%}%>"}();var app_container={};app_container.$configPhase={$component:{},$injectable:{}},app_container.$runPhase={$component:{},$injectable:{}};var makeScope=makeScopeId();app_container.defineConfig=function(e,t){var n="config";return app_container.$configPhase.$component[e]=makeComponent(t),app_container.$configPhase.$component[e].type=n,this},app_container.defineController=function(e,t){var n="controller";return app_container.$runPhase.$component[e]=makeComponent(t),app_container.$runPhase.$component[e].type=n,this},app_container.defineFactory=function(e,t){var n="factory";return app_container.$runPhase.$component[e]=makeComponent(t),app_container.$runPhase.$component[e].type=n,app_container.$runPhase.$injectable[e]=app_container.$runPhase.$component[e].$const,this},app_container.defineProvider=function(e,t){var n="provider";return app_container.$configPhase.$component[e]=makeComponent(t),app_container.$configPhase.$component[e].type=n,app_container.$configPhase.$injectable[e]=app_container.$configPhase.$component[e].$const,this},window.addEventListener("load",function(e){makePhase(app_container.$configPhase),makePhase(app_container.$runPhase),console.log(app_container)}),window.app_container=app_container,app_container.defineProvider("$ajax",[function(){var e={timeout:1e4,query_param:{}},t=function(e){util.ajax(e)};return{option:e,request:t,$config:[function(){return{option:e,request:t}}]}}]),app_container.defineProvider("$ButtonHandler",[function(){var e={eventType:"click",callback:null},t={};return t.setButtonEvent=function(t,n,r){var t;if(t=t?t:e.eventType,!n&&"function"==typeof n)throw new Error("You should define callback for the button");if(!r)throw new Error("You should select an element for the button");if(r.length>1)throw new Error("You should select only one element at a time");r.addEventListener(t,n)},t.$config=[function(){return{getCurrentOption:function(){return e}}}],t}]);var UserAgent=navigator.userAgent.toLowerCase(),chrome="Chrome",safari="Safari",ie="Internet Explorer",IEVersion;if(-1!=UserAgent.indexOf("chrome"))UserAgent=chrome;else if(-1!=UserAgent.indexOf("safari"))UserAgent=safari;else if(-1!=UserAgent.indexOf("msie"))UserAgent=ie,IEVersion=getIEVersion(),console.log("IE Version: "+IEVersion),void 0==window.console&&(console={log:function(){}});else{var trident=navigator.userAgent.match(/Trident\/(\d)/i);if(trident){if(UserAgent=ie,void 0==window.console&&(console={log:function(){}}),"6"===trident[1])IEVersion="10";else{if("7"!==trident[1])throw new Error("This App only supports v 10 and v 11 of Internet Explorer");IEVersion="11"}console.log("IE Version: "+IEVersion)}else UserAgent="Other Browser"}var util={},xmlhttp=null;util.ajax=function(e){var t={url:null,type:"GET",data:null,async:!0,timeout:5e3,dataType:"text",success:null,error:null,complete:null,requestHeader:null};for(var n in e)t[n]=e[n];if(t.url){if(xmlhttp=null,xmlhttp=new XMLHttpRequest,"GET"===t.type&&t.data&&(t.data=encodeFormData(t.data),t.url=t.url+"?"+t.data,t.data=null),xmlhttp.open(t.type,t.url,t.async),t.type=t.type.toUpperCase(),t.async&&(xmlhttp.timeout=t.timeout),xmlhttp.onload=function(e){var n,r;if(200===xmlhttp.status||0===xmlhttp.status){if("function"==typeof t.success)if("json"===t.dataType)if(this.responseText){try{r=JSON.parse(this.responseText)}catch(o){return void t.error(this,"json parsererror",o)}t.success(r,this.statusText,xmlhttp)}else t.error(this,"empty json",this.statusText);else if("xml"===t.dataType)if(this.responseXML)t.success(this.responseXML,this.statusText,this);else if(this.responseText){try{n=obigo.parseXML(this.responseText)}catch(o){return void t.error(this,"xml parsererror",o)}t.success(n,this.statusText,this)}else t.error(this,"empty xml",this.statusText);else t.success(this.responseText,this.statusText,this)}else 0!==xmlhttp.status&&t.error(xmlhttp,"error",xmlhttp.statusText)},xmlhttp.ontimeout=function(e){"function"==typeof t.error&&t.error(xmlhttp,"timeout","timeout")},xmlhttp.onerror=function(e){"function"==typeof t.error&&("string"==typeof e&&"timeerror"==e?t.error(xmlhttp,"timeerror",xmlhttp.statusText):t.error(xmlhttp,"error",xmlhttp.statusText))},xmlhttp.onloadend=function(e){"function"==typeof t.complete&&t.complete(xmlhttp,xmlhttp.statusText)},"POST"!==t.type||JSON.stringify(t.requestHeader).match(/content-type/gi)||xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),t.requestHeader){var r=t.requestHeader;for(var o in r)r.hasOwnProperty(o)&&xmlhttp.setRequestHeader(o,r[o])}return"object"==typeof t.data&&(t.data=encodeFormData(t.data)),xmlhttp.send(t.data),xmlhttp}},util.xmltoJson=function(e){function t(e,t){function r(e,n){if(!e)return null;var o="",a=null,i=null;e.nodeType,jsVar(e.localName||e.nodeName),e.text||e.nodeValue||"";e.childNodes&&e.childNodes.length>0&&each(e.childNodes,function(e,t){var n=t.nodeType,i=jsVar(t.localName||t.nodeName),s=t.text||t.nodeValue||"";if(8!==n)if(3!==n&&4!==n&&i)a=a||{},a[i]?(a[i].length||(a[i]=myArr(a[i])),a[i]=myArr(a[i]),a[i][a[i].length]=r(t,!0),a[i].length=a[i].length):a[i]=r(t);else{if(s.match(/^\s+$/))return;o+=s.replace(/^\s+/,"").replace(/\s+$/,"")}}),e.attributes&&e.attributes.length>0&&(i={},a=a||{},each(e.attributes,function(e,t){var n=jsVar(t.name),r=t.value;i[n]=r,a[n]?(a[cnn]=myArr(a[cnn]),a[n][a[n].length]=r,a[n].length=a[n].length):a[n]=r})),a&&(a=extend(""!==o?o.toString():{},a||{}),o=a.text?("object"==typeof a.text?a.text:[a.text||""]).concat([o]):o,o&&(a.text=o),o="");var s=a||o;return t&&(o&&(s={}),o=s.text||o||"",o&&(s.text=o),n||(s=myArr(s))),s}if(e&&("string"==typeof e&&(e=n(e)),e.nodeType)){if(3===e.nodeType||4===e.nodeType)return e.nodeValue;var o=9===e.nodeType?e.documentElement:e,a=r(o,!0);return e=null,o=null,a}}function n(e){var t,n=new DOMParser;try{n.async=!1}catch(r){throw new Error("XML Parser could not be instantiated")}try{t=n.parseFromString(e,"text/xml")}catch(r){throw new Error("Error parsing XML string")}return t}return t(e)},app_container.defineConfig("mainConfig",function(e){e.when("/",{templateUrl:"inject.html",controller:"test_main"}).when("/page1?:id",{templateUrl:"inject2.html",controller:"test_main2"}).when("/page2",{templateUrl:"inject3.html",controller:"test_main3"}),window.addEventListener("hashchange",e.router),window.addEventListener("load",e.router)}),app_container.defineProvider("$tab",["$ButtonHandler",function(e){function t(){var e,t,n,r,a=[];e=o.querySelector(".tabs_head"),t=e.getElementsByTagName("li"),n=t.length;for(var i=0;n>i;i++)r=t[i].firstElementChild.getAttribute("href"),r=r.replace("#",""),a.push(r);return a}function n(e,t){var n=e.querySelector(".tabs_body");if(n.children<0)throw new Error("You should define tab name more than one");return n.children[t].getAttribute("id")}function r(t){for(var n=t,r=n.children.length,o=0;r>o;o++)e.setButtonEvent("click",a[o],t.children[o])}var o=null,a=[],i=function(e){if("DIV"!==e.nodeName)throw new Error(e+"is not a DIV element. You should define tab area with DIV");o=e},s=function(e){if(!o)throw new Error("You should first define tab area");this.tab_head_list=e},c=function(){if(!o)throw new Error("You should first define tab area");if(this.tab_head_list.constructor!==Array)throw new Error("You should make tab name in array form");if(this.tab_head_list.length<=0)throw new Error("You should define more than 1 tab name");for(var e=this.tab_head_list.length,t="",n=0;e>n;n++)t+="<li><a href='#tabmenu"+n+"'>"+this.tab_head_list[n]+"</a></li>";return t},l=function(){if(!o)throw new Error("You should first define tab area");var e;if(this.tab_ids=t(),e=this.tab_ids.length,0>=e)throw new Error("There is no tab head");for(var n="",r=0;e>r;r++)n+="<div class='tabContent' id='"+this.tab_ids[r]+"'></div>";return n},p=function(e){if(!o)throw new Error("You should first define tab area");for(var t=Object.keys(e),n=t.length,r=0;n>r;r++)a.push(e[t[r]])},u=function(e){var t=o.querySelector(".tabs_body"),n=o.querySelector(".tabs_head");t.firstElementChild.classList.add("show"),r(n),"function"==typeof e&&e()};return{setTabNames:s,makeTabHeadTemplate:c,setTabArea:i,$config:[function(){return{setTabNames:s,makeTabBodyTemplate:l,makeTabHeadTemplate:c,defineTabCallbacks:p,getTabBodyId:n,setTabArea:i,run:u}}]}}]);